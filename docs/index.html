<!DOCTYPE html><html lang="ja">
<head>
	<meta charset="utf-8" />
	<title>n138-kz.github.io</title>
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Expires" content="0">
	<link rel="preconnect dns-prefetch" href="//github.com">
	<link rel="preconnect dns-prefetch" href="//n138-kz.github.io">
	<link rel="preconnect dns-prefetch" href="//code.jquery.com">
	<link rel="preconnect dns-prefetch" href="//accounts.google.com">
	<link rel="preconnect dns-prefetch" href="//www.google.com">
	<link rel="stylesheet" type="text/css" href="https://n138-kz.github.io/lib/master.css?t=0" />
	<script src="https://n138-kz.github.io/lib/master.js"></script>
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://accounts.google.com/gsi/client" async defer></script>
	<script src="https://www.google.com/recaptcha/api.js?render=6LfCHdcUAAAAAOwkHsW_7W7MfoOrvoIw9CXdLRBA"></script>
	<script src="https://n138-kz.github.io/lib/grecaptcha.js"></script>
	<style>
		form fieldset input {
			width: stretch;
		}
		form div.message {
			font-size: small;
			background-color: #ffffff;
			width: stretch;
			padding: 5px;
		}
		form div.message.warning {
			background-color: #ffa500;
		}
		form div.message.command {
			background-color: #000000;
			color: lime;
		}
	</style>
	<script>
		window.addEventListener('DOMContentLoaded', async ()=>{
			Array.from(document.querySelectorAll('form fieldset input')).map((ep)=>{
				ep.addEventListener('click', (ec)=>{
					ec.target.select();
				});
				ep.addEventListener('change', (ec)=>{
					let credentials = localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials');
					credentials = JSON.parse(credentials);
					credentials[ec.target.id] = btoa(ec.target.value);
					localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials', JSON.stringify(credentials) );
				});
			});

			let credentials = localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials');
			if(false
				||credentials === null
				||credentials === undefined
				||credentials === ''
			){
				localcache_init();
			}
			credentials = JSON.parse(credentials);

			let list = ['username','password','tenantId',];
			for (let i=0; i<list.length; i++) {
				if(false
					||credentials[list[i]] === null
					||credentials[list[i]] === undefined
					||credentials[list[i]] === ''
				){
					credentials[list[i]] = '';
				}
				document.querySelector('form fieldset input#'+list[i]).value = atob(credentials[list[i]]);
			}
		});
		function localcache_init() {
			let credentials = localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials');
			if(false
				||credentials === null
				||credentials === undefined
				||credentials === ''
			){
				credentials = {username:null,password:null,tenantId:null,};
				localStorage.setItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials', JSON.stringify(credentials) );
			}
		}
		async function getTokens(button) {
			button.disabled = true;

			let credentials = localStorage.getItem( (btoa(location.href)).slice(0, 16) + '.'+'credentials');
			if(false
				||credentials === null
				||credentials === undefined
				||credentials === ''
			){
				localcache_init();
			}
			credentials = JSON.parse(credentials);

			let list = ['username','password','tenantId',];
			for (let i=0; i<list.length; i++) {
				if(false
					||credentials[list[i]] === null
					||credentials[list[i]] === undefined
					||credentials[list[i]] === ''
				){
					credentials[list[i]] = '';
				}
			}

			try {
				let external_api = {};
				external_api.endpoint = 'https://identity.tyo1.conoha.io/v2.0/tokens';
				external_api.data = {
					auth: {
						passwordCredentials: {
							username: atob(credentials.username),
							password: atob(credentials.password),
						},
						tenantId: atob(credentials.tenantId),
					},
				};
				external_api.data = JSON.stringify(external_api.data);
				{
					let dom = document.createElement('div');
					dom.innerText = '';
					dom.innerText += 'conoha_client_token=$('
					dom.innerText += 'curl'
					dom.innerText += ' -s'
					dom.innerText += ' -X POST'
					dom.innerText += ' -H \'Accept: application/json\''
					dom.innerText += ' -H \'Content-Type: application/json;charset=utf-8\''
					dom.innerText += ' -H \'Access-Control-Allow-Origin: *\''
					dom.innerText += ' -d \'' + external_api.data + '\''
					dom.innerText += ` ${external_api.endpoint}`;
					dom.innerText += ');';
					dom.innerText += 'conoha_client_token=$(';
					dom.innerText += ' echo ${conoha_client_token}';
					dom.innerText += ' | jq -r .access.token.id';
					dom.innerText += ');';
					dom.innerText += 'echo -e "\\e[32m${conoha_client_token}\\e[m"';
					dom.classList.add('message');
					dom.classList.add('command');
					document.querySelectorAll('form')[0].appendChild(dom);
				}
				let req = await fetch(external_api.endpoint, {
					method: 'POST',
					mode: 'cors',
					headers: {
						Accept: 'application/json',
						"Content-Type": "application/json;charset=utf-8",
						"Access-Control-Allow-Origin": '*',
					},
					body: external_api.data,
				});
				console.log(req.ok);
				
				let res = await req.json();

			} catch (th) {
				console.error('Error:', th.message, th.stack);
				let dom = document.createElement('div');
				dom.innerText = `Error: ${th.message}`;
				dom.classList.add('message');
				dom.classList.add('warning');
				document.querySelectorAll('form')[0].appendChild(dom);
			}
			
			button.disabled = false;
		}
	</script>
</head>
<body>
	<form action="" method="post">
		<fieldset>
			<legend>username</legend>
			<input type="text" id="username">
		</fieldset>
		<fieldset>
			<legend>password</legend>
			<input type="password" id="password">
		</fieldset>
		<fieldset>
			<legend>tenant-id</legend>
			<input type="text" id="tenantId">
		</fieldset>
		<input type="button" value="トークン発行" onclick="getTokens(this);">
		<input type="button" value="キャッシュ削除" onclick="if(window.confirm('キャッシュデータ削除しますか？\n不具合が発生している場合のみお試しください。')){localStorage.clear();sessionStorage.clear();location.reload();}">
	</form>
</body>
</html>
